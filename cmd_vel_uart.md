import rclpy from rclpy.node import Node from geometry_msgs.msg import Twist import serial import struct class OmnidirectionalSerialNode(Node):    def __init__(self):        super().__init__('omni_serial_bridge')                # 1. 声明和获取参数        self.declare_parameter('port', '/dev/ttyUSB1')        self.declare_parameter('baudrate', 115200)                port = self.get_parameter('port').get_parameter_value().string_value        baud = self.get_parameter('baudrate').get_parameter_value().integer_value                # 2. 初始化串口        try:            self.ser = serial.Serial(port, baud, timeout=0.1)            self.get_logger().info(f"串口已连接: {port} 波特率: {baud}")        except Exception as e:            self.get_logger().error(f"串口打开失败: {e}")            return         # 3. 订阅 cmd_vel        self.subscription = self.create_subscription(            Twist,            'cmd_vel',            self.cmd_vel_callback,            10)                # 定义帧头帧尾        self.header = 0x9A        self.footer = 0x1B     def cmd_vel_callback(self, msg):        # 提取全向轮所需的三个速度        vx = msg.linear.x    # 前后 m/s        vy = msg.linear.y    # 左右 m/s        wz = msg.angular.z   # 旋转 rad/s         # 4. 数据打包        # 格式说明 '<BfffB':        # < : 小端对齐        # B : 帧头 (1字节, unsigned char)        # f : vx (4字节, float)        # f : vy (4字节, float)        # f : wz (4字节, float)        # B : 帧尾 (1字节, unsigned char)        try:            # 打包成 14 字节的二进制流            packet = struct.pack('<BfffB', self.header, vx, vy, wz, self.footer)                        # 发送            self.ser.write(packet)                        # 调试信息（正式使用时可注释掉）            self.get_logger().info(f'Send -> vx:{vx:.2f}, vy:{vy:.2f}, wz:{wz:.2f}')                    except Exception as e:            self.get_logger().error(f"发送数据出错: {e}")     def destroy_node(self):        if hasattr(self, 'ser') and self.ser.is_open:            self.ser.close()        super().destroy_node() def main(args=None):    rclpy.init(args=args)    node = OmnidirectionalSerialNode()    try:        rclpy.spin(node)    except KeyboardInterrupt:        pass    finally:        node.destroy_node()        rclpy.shutdown() if __name__ == '__main__':    main()